<html>
	<head>
		<title>chat</title>
		<style>
			#chatbox,#usernames{
				 display:none; 
			}
			#usernames,#chatsystem{
				float:left;
			}
			#usernames{
				margin-right:24px;
			}
			.clearfix{
				clear:left;
			}
			body{
				background:#f0f0f0;
			}
		</style>
	</head>
	<body>

		<div id="usernames"></div>
		<div id="chatsystem">
			<form id="usernamebox">
				<span>type in your nickname</span>
				<input type="text" id="nickname"><br>
				<!-- <span>type in your roomname</span>
				<input type="text" id="roomname"> -->
				<input type="submit">
			</form>
			
			<div id="chatbox">
				<div id="chat"></div>
				<form id="send-message">
					<input type="text" id="message" size="35">
					<input type="submit">
				</form>
			</div>
		</div>
		<div class="clearfix"></div>
		
		
		<!--== <script src="node_modules/jquery/dist/jquery.js"></script> ==-->
		<script src="http://code.jquery.com/jquery-latest.min.js"></script>
		<script src="/socket.io/socket.io.js"></script>

		<script>
			jQuery(function($){
				var socket = io.connect();
				var $messageForm = $('#send-message');
				var $messageBox = $('#message');
				var $chat = $('#chat');
				var $chatbox = $('#chatbox');
				var $usernamebox = $('#usernamebox');
				var $usernames = $('#usernames');
				var $nickname = $('#nickname');
				var $roomname = $('#roomname');

				$usernamebox.submit(function(e){
					e.preventDefault();
					socket.emit('set nickname',$nickname.val(),$roomname.val(),function(data){
						console.log(data);
						if(data){
							$nickname.val('');
							$usernamebox.hide();
							$chatbox.show();
							$usernames.show();

						}else{
							console.log('that user name is already taken');
						}
					});
					
				});


				$messageForm.submit(function(e){
					e.preventDefault();
					socket.emit('send message',$messageBox.val());
					$messageBox.val('');
					
				});

				$('.user').on('click',function(){
						var a = $(this).attr('data-name');
						console.log(a);
						socket.emit('switch room',a);
						
				});

				socket.on('usernames', function(data){
					var html = '';
					$.each(data,function(index,value){
						console.log(index + ': ' + value );
						html = `${html} <button class='user' data-name='${data[index]}'>${data[index]}</button><br/>`;
					});
					$usernames.html(html);
					console.log(data);
					//$chat.append(`${data[data.length - 1]} entered the conversation <br/>`);

				});

				socket.on('new message',function(data){
					$chat.append(`${data.name}: ${data.msg}<br/>`);
					console.log(data);
				});

			});
		</script>
	</body>
</html>